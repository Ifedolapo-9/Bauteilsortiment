{#
Bauteilsortiment - An Electronic Component Archival System
Copyright (C) 2023  nomike

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
#}
{% extends "bts/base.html" %}
{% load static %}
{% load view_extras %}
{% block title %}Detail page for {% get_verbose_name object %}: {{ object }}{% endblock %}
{% block page_title %}Detail page for {% get_verbose_name object %}: {{ object }}{% endblock %}
{% block body %}
    <p id="breadcrumbs"><a href="{% url "home" %}">Home</a> / <a href="{% url object|get_type|add:"_list"|snake_case %}">{% get_verbose_name object %}s</a> / {{ object }}</p>
    <p>
        <table id="object" class="maintable">
            <tr>
                <th>Attribute</th>
                <th>Value</th>
            </tr>
            {% for field in fields %}
            <tr>
                <td>{{ field.verbose_name }}</td>
                <td>
                    {% is_url_field field as is_url_field %}
                    {% is_foreign_key_field field as is_foreign_key_field %}
                    {% if is_url_field %}
                    <a href="{{ object|hash:field.name }}">{{ object|hash:field.name }}</a>
                    {% elif is_foreign_key_field %}
                        {% cat field.name "_id" as id_column %}
                        {% if object|hash:id_column is not None %}
                            {% get_detail_name field "" as detail_name %}
                            <a href="{% url detail_name|snake_case|add:"_detail" object|hash:id_column %}">{{ object|hash:field.name }}</a>
                        {% else %}
                                {{ object|hash:id_column }}
                        {% endif %}
                    {% else %}
                        {{ object|hash:field.name }}
                    {% endif %}                    
                </td>
            </tr>
            {% endfor %}
        </table>
    </p>
    <script>
          function openSublist(evt, sublistName) {
            var i, x, tablinks;
            x = document.getElementsByClassName("sublist");
            for (i = 0; i < x.length; i++) {
              x[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < x.length; i++) {
              tablinks[i].className = tablinks[i].className.replace(" green", "");
            }
            document.getElementById(sublistName).style.display = "block";
            evt.currentTarget.className += " green";
          }
          
          window.addEventListener('load', function () {
            document.getElementsByClassName("tablink")[0].click();
          })
          
    </script>
    <div class="bar grey">
        {% for sublist in sublists %}
        <button class="bar-item button tablink grey" onclick="openSublist(event, '{{ sublist }}')">{{ sublist|snake_case|snake_to_space }}s</button>
        {% endfor %}
    </div>     
    {% for sublist in sublists %}
    <script>
        fetch("{% url sublist|snake_case|add:"_filtered_list" object|get_type object.pk %}" /*, options */)
        .then((response) => response.text())
        .then((html) => {
            document.getElementById("{{ sublist }}").innerHTML = html;
        })
        .catch((error) => {
            console.warn(error);
        });
    </script>
    <div id="{{ sublist }}" class="sublist"></div>
    {% endfor %}
{% endblock %}
