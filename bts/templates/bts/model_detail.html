{% extends "bts/base.html" %}
{% load static %}
{% load view_extras %}
{% block title %}Detail page for {% get_verbose_name object %}: {{ object }}{% endblock %}
{% block page_title %}Detail page for {% get_verbose_name object %}: {{ object }}{% endblock %}
{% block body %}
    <p id="breadcrumbs"><a href="{% url object|get_type|add:"_list"|snake_case %}">{% get_verbose_name object %}s</a> / {{ object }}</p>
    <p>
        <table id="object" class="maintable">
            <tr>
                <th>Attribute</th>
                <th>Value</th>
            </tr>
            {% for field in fields %}
            <tr>
                <td>{{ field.verbose_name }}</td>
                <td>
                    {% is_url_field field as is_url_field %}
                    {% is_foreign_key_field field as is_foreign_key_field %}
                    {% if is_url_field %}
                    <a href="{{ object|hash:field.name }}">{{ object|hash:field.name }}</a>
                    {% elif is_foreign_key_field %}
                        {% cat field.name "_id" as id_column %}
                        {% if object|hash:id_column is not None %}
                            {% get_detail_name field "" as detail_name %}
                            <a href="{% url detail_name|snake_case|add:"_detail" object|hash:id_column %}">{{ object|hash:field.name }}</a>
                        {% else %}
                                {{ object|hash:id_column }}
                        {% endif %}
                    {% else %}
                        {{ object|hash:field.name }}
                    {% endif %}                    
                </td>
            </tr>
            {% endfor %}
        </table>
    </p>
    {% for sublist in object.meta_sublist %}
    <h2>{{ sublist }}s</h2>
    <script>
        fetch("{% url sublist|snake_case|add:"_filtered_list" object|get_type object.pk %}" /*, options */)
        .then((response) => response.text())
        .then((html) => {
            document.getElementById("{{ sublist }}").innerHTML = html;
        })
        .catch((error) => {
            console.warn(error);
        });
    </script>
    <div id="{{ sublist }}"></div>
    {% endfor %}
{% endblock %}